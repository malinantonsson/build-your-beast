var downloadButton=document.getElementById("print"),canvasWrapper=document.getElementsByClassName("byb-canvas")[0],canvas,beastCanvas,DOMURL=window.URL||window.webkitURL||window,beast={colour:{id:"pink",x:0,y:0,"short":"h",el:"trick-or-treat"},crown:{id:"",x:0,y:0,"short":"c",el:"byb-canvas-crown"},eyes:{id:"",x:87,y:210,"short":"e",el:"byb-canvas-eyes"},nose:{id:"",x:87,y:320,"short":"n",el:"byb-canvas-nose"},mouth:{id:"",x:87,y:430,"short":"m",el:"byb-canvas-mouth"}},addItem=function(e,t){var a=new Image,n=new Blob([e.data],{type:"image/svg+xml"}),s=DOMURL.createObjectURL(n);a.onload=function(){beastCanvas.drawImage(a,e.x,e.y),DOMURL.revokeObjectURL(s)},a.src=s},addBeastColour=function(e){switch(e){case"pink":hex="#ed6171";break;case"green":hex="#02583f";break;case"red":hex="#a7361d"}return'<svg xmlns="http://www.w3.org/2000/svg" width="480" height="608" x="0px" y="0px" viewBox="0 0 479.5 608" enable-background="new 0 0 479.5 608" xml:space="preserve"><g id="background"><rect x="-270" y="-51" display="inline" width="100%" height="100%"/></g><g id="face_colour_1"><path fill="'+hex+'" d="M393,456.4c0,84.3-68.3,152.6-152.6,152.6h-0.7C155.3,609,87,540.7,87,456.4V232.6C87,148.3,155.3,80,239.6,80h0.7C324.7,80,393,148.3,393,232.6V456.4z"/></g></svg>'},downloadImageLink=function(e){return e.replace("image/png","image/octet-stream")},getImgData=function(){var e=canvas.toDataURL();return downloadImageLink(e)},addSelectedItems=function(){for(var e in beast){var t,a=beast[e].id;t="colour"===e?addBeastColour(beast.colour.id):svgData[e][a];var n={data:t,x:beast[e].x,y:beast[e].y};addItem(n)}},createCanvas=function(){canvas=document.createElement("canvas"),canvas.id="byb-canvas__canvas",canvas.width=480,canvas.height=608,beastCanvas=canvas.getContext("2d"),beastCanvas.clearRect(0,0,canvas.width,canvas.height),beastCanvas.fillStyle="#000",beastCanvas.fillRect(0,0,canvas.width,canvas.height),beastCanvas.fill(),canvasWrapper.appendChild(canvas)},clearCanvas=function(){beastCanvas&&(beastCanvas.clearRect(0,0,canvas.width,canvas.height),beastCanvas.fillStyle="#000",beastCanvas.fillRect(0,0,canvas.width,canvas.height),beastCanvas.fill())},closeImageOverlay=function(e,t){e.addEventListener("click",function(e){t.style.display="none"})},initDownload=function(){var e=document.querySelector(".download-image-wrapper"),t=document.querySelector(".download-image-content"),a=document.querySelector(".js-download-image__image");downloadButton.addEventListener("click",function(n){var s=getImgData();if(window.Modernizr&&window.Modernizr.touch){n.preventDefault(),a.src=s,t.appendChild(a),e.style.display="block";var i=document.querySelector(".js-close-image-overlay");closeImageOverlay(i,e)}else downloadButton.href=s;return!1})};window.Modernizr&&window.Modernizr.canvas?downloadButton&&(initDownload(),createCanvas()):console.log("hide canvas");var aboutBtn=document.getElementById("about-btn"),aboutOverlay=document.getElementById("aboutOverlay"),closeBtn=document.getElementById("close-btn"),body=document.getElementsByTagName("body"),hideClass="is-hidden",overlayOpenClass="overlay-open";aboutBtn&&aboutBtn.addEventListener("click",function(){aboutOverlay.classList.remove(hideClass),body[0].classList.add(overlayOpenClass)}),closeBtn&&closeBtn.addEventListener("click",function(){aboutOverlay.classList.add(hideClass),body[0].classList.remove(overlayOpenClass)});var deactivateTabs={settings:{currentSlide:0,deactiveClass:"is-deactivated"},ui:{},init:function(){var e=document.querySelector("#tabs");this.ui.tabsLinks=e.querySelectorAll(".c-tabs-nav__link")},setCurrentSlide:function(e){this.settings.currentSlide=e},activate:function(e){var t;if(e)t=this.ui.tabsLinks[e];else{var a=this.settings.currentSlide;t=this.ui.tabsLinks[a+1]}t.classList.contains(this.settings.deactiveClass)&&t.classList.remove(this.settings.deactiveClass)}};deactivateTabs.init();var initCarousel=function(e){$(e).bxSlider({slideWidth:180,minSlides:2,maxSlides:6,slideMargin:0,adaptiveHeight:!0,pager:!1,nextText:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z"/></svg>',prevText:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z"/></svg>'})},colours=$("body").find(".tab-content-colour");colours.each(function(e,t){deactivateTabs.activate();var a=$(t).attr("id");$(t).on("click",function(){beast.colour.id=a,$("body")[0].className="active-colour-"+a})});var svgData,outerWrapper=document.querySelector(".byb-outside-wrapper"),introWrapper=document.querySelector(".intro-lightning"),introClass="is-intro",hideIntroClass="intro-end",removeIntroClass="intro-hidden",introIsFinished=!1;setTimeout(function(){introIsFinished||(introIsFinished=!0)},4500);var finishIntro=function(){introWrapper.classList.add(hideIntroClass),setTimeout(function(){outerWrapper.classList.remove(introClass),introWrapper.classList.add(removeIntroClass),outerWrapper.style.display="block"},1e3)},request=new XMLHttpRequest;request.open("GET","/data/beast-data.json",!0),request.send(),request.onload=function(){if(this.status>=200&&this.status<400)if(svgData=JSON.parse(this.response),introIsFinished)finishIntro();else var e=setInterval(function(){introIsFinished&&(clearInterval(e),finishIntro())},500);else console.log(this.status),console.log("returned error")},request.onerror=function(){console.log("connection error")};var sliders=$("body").find(".slider"),beastHasItems=[];sliders.each(function(e,t){var a=$(t).attr("id"),n=$(t).find(".tab-content-icon-link");$(this).closest("c-tabs-nav__link");n.each(function(e,t){var n=$(t).attr("id");$(t).on("click",function(e){e.preventDefault();var t=n.replace(/.*?(?=[0-9]|$)/gi,"");beast[a].id=t,-1==beastHasItems.indexOf(a)&&beastHasItems.push(a),4==beastHasItems.length&&deactivateTabs.activate(5);var s=svgData[a][t];$(".byb-canvas-"+a).html(s)})})}),function(){"use strict";var e=function(e){var t,a=document.querySelector(e.el),n=a.querySelectorAll(e.tabNavigationLinks),s=a.querySelectorAll(e.tabContentContainers),i=0,o=!1,r=function(){if(!o){o=!0,a.classList.remove("no-js");for(var e=0;e<n.length;e++){var t=n[e];c(t,e)}}},c=function(e,t){e.addEventListener("click",function(e){e.preventDefault(),l(t)})},l=function(e){n[e].classList.contains("is-deactivated")||e!==i&&e>=0&&e<=n.length&&(n[i].classList.remove("is-active"),n[e].classList.add("is-active"),s[i].classList.remove("is-active"),s[e].classList.add("is-active"),i=e,t=s[i].querySelectorAll(".slider"),t.length>0&&initCarousel(t),5===e?initShare():clearCanvas())};return{init:r,goToTab:l}};window.tabs=e}();var twitterButton=document.getElementById("twitter"),facebookButton=document.getElementById("facebook"),initShare=function(){createUrl();addSelectedItems()};twitterButton&&twitterButton.addEventListener("click",function(e){e.preventDefault();var t="Trick or Treat",a="https://twitter.com/intent/tweet?text="+t+"&hashtags=buildyourbeast&url="+createUrl();return window.open(a,"twWindow","status = 1, height = 380, width = 500, resizable = 0"),!1}),facebookButton&&facebookButton.addEventListener("click",function(e){return e.preventDefault(),fburl="https://www.facebook.com/sharer/sharer.php?u="+createUrl(),window.open(fburl,"fbWindow","status = 1, height = 380, width = 500, resizable = 0"),!1});var createUrl=function(){var e=window.location.href||"http://www.buildyourbeast.co.uk/",t=e+"trickortreat/?h="+beast.colour.id+"&c="+beast.crown.id+"&e="+beast.eyes.id+"&n="+beast.nose.id+"&m="+beast.mouth.id;return encodeURIComponent(t)};